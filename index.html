import React, { useState, useCallback } from 'react';
import { Upload } from 'lucide-react';

const ImageUploader = ({ onImageSelect, currentImage }) => {
  const [previewUrl, setPreviewUrl] = useState(currentImage || '');

  const handleFileSelect = useCallback((event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreviewUrl(reader.result);
        onImageSelect(file);
      };
      reader.readAsDataURL(file);
    }
  }, [onImageSelect]);

  return (
    <div className="mb-4">
      <div className="flex items-center gap-4">
        {previewUrl && (
          <img 
            src={previewUrl} 
            alt="Preview" 
            className="w-12 h-12 rounded-full object-cover"
          />
        )}
        <label className="flex items-center px-4 py-2 bg-blue-500 text-white rounded cursor-pointer hover:bg-blue-600">
          <Upload className="w-4 h-4 mr-2" />
          <span>Select Image</span>
          <input
            type="file"
            className="hidden"
            accept="image/*"
            onChange={handleFileSelect}
          />
        </label>
      </div>
    </div>
  );
};

const SocialProfileEditor = () => {
  const [profiles, setProfiles] = useState([]);
  const [currentProfile, setCurrentProfile] = useState({
    platform: '',
    url: '',
    image: null
  });

  const handleAddProfile = useCallback(() => {
    if (currentProfile.platform && currentProfile.url) {
      setProfiles(prev => [...prev, { ...currentProfile }]);
      setCurrentProfile({ platform: '', url: '', image: null });
    }
  }, [currentProfile]);

  const handleRemoveProfile = useCallback((index) => {
    setProfiles(prev => prev.filter((_, i) => i !== index));
  }, []);

  return (
    <div className="max-w-2xl mx-auto p-4">
      <div className="bg-white rounded shadow p-6">
        <h2 className="text-xl font-bold mb-6">Social Media Profiles</h2>
        
        <div className="space-y-4 mb-6">
          <select 
            value={currentProfile.platform}
            onChange={(e) => setCurrentProfile(prev => ({ ...prev, platform: e.target.value }))}
            className="w-full p-2 border rounded bg-white"
          >
            <option value="">Select Platform</option>
            <option value="youtube">YouTube</option>
            <option value="facebook">Facebook</option>
            <option value="twitter">Twitter/X</option>
            <option value="instagram">Instagram</option>
            <option value="linkedin">LinkedIn</option>
            <option value="tiktok">TikTok</option>
            <option value="github">GitHub</option>
          </select>

          <input
            type="url"
            value={currentProfile.url}
            onChange={(e) => setCurrentProfile(prev => ({ ...prev, url: e.target.value }))}
            placeholder="Profile URL"
            className="w-full p-2 border rounded"
          />

          <ImageUploader 
            onImageSelect={(file) => setCurrentProfile(prev => ({ ...prev, image: file }))}
            currentImage={currentProfile.image ? URL.createObjectURL(currentProfile.image) : null}
          />

          <button
            onClick={handleAddProfile}
            disabled={!currentProfile.platform || !currentProfile.url}
            className="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
          >
            Add Profile
          </button>
        </div>

        <div className="border-t pt-6">
          <h3 className="text-lg font-semibold mb-4">Added Profiles</h3>
          <div className="space-y-3">
            {profiles.map((profile, index) => (
              <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded">
                <div className="flex items-center gap-3">
                  {profile.image && (
                    <img 
                      src={URL.createObjectURL(profile.image)}
                      alt={profile.platform}
                      className="w-10 h-10 rounded-full object-cover"
                    />
                  )}
                  <div>
                    <div className="font-medium">{profile.platform}</div>
                    <a href={profile.url} className="text-sm text-blue-500 hover:underline truncate max-w-xs block" target="_blank" rel="noopener noreferrer">
                      {profile.url}
                    </a>
                  </div>
                </div>
                <button
                  onClick={() => handleRemoveProfile(index)}
                  className="text-red-500 hover:text-red-600 p-1"
                >
                  Remove
                </button>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default SocialProfileEditor;
